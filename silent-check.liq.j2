set("console.colorize", "auto")

{% set min_noise_default = 0.0 %}
{% set max_blank_default = 20.0 %}
{% set threshold_default = -40.0 %}

{% for source in sources %}
{{ source.name }} = audio_to_stereo(mksafe(input.http('{{ source.url }}')))

def noise_{{ source.name }}()
  system('./silent-check-prom.py --noise --source {{ source.name }} --min_noise {{ source.min_noise | d(min_noise_default) }} --max_blank {{ source.max_blank | d(max_blank_default) }} --threshold {{ source.threshold | d(threshold_default) }}')
end

def blank_{{ source.name }}()
  system('./silent-check-prom.py --blank --source {{ source.name }} --min_noise {{ source.min_noise | d(min_noise_default) }} --max_blank {{ source.max_blank | d(max_blank_default) }} --threshold {{ source.threshold | d(threshold_default) }}')
end

blank_{{ source.name }}()
output.dummy(
on_blank(
  max_blank={{ source.max_blank | d(max_blank_default) }},
  min_noise={{ source.min_noise | d(min_noise_default) }},
  threshold={{ source.threshold | d(threshold_default) }},
  start_blank=true,
  track_sensitive=false,
  on_noise=noise_{{ source.name }},
  blank_{{ source.name }},
  {{ source.name }}
)
)

{% endfor %}
